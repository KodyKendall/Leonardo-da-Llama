<p style="color: green"><%= notice %></p>

<% content_for :title, "Messages" %>

<h1>Messages</h1>

<% if @messages %>
  <h2>Conversation with <%= @conversation_partner %></h2>
  <div class="conversation">
    <% @messages.each do |msg| %>
      <div class="message <%= msg.sent_from == current_organization.twilio_number ? 'sent' : 'received' %>">
        <strong><%= msg.sent_from == current_organization.twilio_number ? "You" : msg.sent_from %>:</strong>
        <%= msg.body %>
        <span class="timestamp"><%= msg.created_at.strftime("%Y-%m-%d %H:%M") %></span>
      </div>
    <% end %>
  </div>
  <%= link_to "Back to Threads", messages_path %>
<% else %>
  <div id="messages">
    <% @message_threads.each do |thread| %>
      <div class="message-thread">
        <strong>Conversation with: <%= thread.conversation_partner %></strong><br>
        Last message: <%= thread.body.truncate(40) %> <br>
        <%= link_to "View Conversation", messages_path(conversation_partner: thread.conversation_partner) %>
      </div>
      <hr>
    <% end %>
  </div>
<% end %>

<%= link_to "New message", new_message_path %>
